# Домашнее задание №9

## Красивая предыстория

Мы создали клон Reddit. Он работает, но мы не знаем, насколько хорошо он работает.
Точнее, мы знаем, что он работает медленнее, чем хотелось бы. Иногда он падает. Иногда
он отвечает с ошибкой. Иногда он отвечает долго. Иногда он отвечает быстро.
К сожалению, из-за этого, пользователи уходят к конкурентам. Нам нужно
понять, что происходит с нашим сервисом и починить его.

## Точка отправления

У нас есть сервис, написанный на предыдущем семинаре. Он представляет собой бэкенд для клона Reddit.
SLO (целевой уровень качества сервиса) у нас следующий:
- 95% запросов должны отвечаться за 50ms
- 99% запросов должны отвечаться за 100ms

## Требования

0. Необходимо настроить логгирование ошибок в Sentry.
1. Необходимо поднять prometheus и grafana
2. Необходимо замониторить ключевые метрики:
   1. Количество хитов на каждый конец с распределением по статусу ответа
   2. Тайминги хитов на каждый конец
   3. Статусы ответов внешних сервисов
   4. Тайминги ответов внешних сервисов
3. Построить дашборд с графиками по этим метрикам в графане
4. На основе этих метрик и ошибок в Sentry нужно выявить проблемные точки(долгие тайминги, невалидные ответы)
5. Проверить дашборд и соблюдение SLA после добавления изменений - демонстрация графика (ссылка на графану с указанием периода на который смотреть)
6. (Опционально за 3 доп. балла) Настроить алерты в чатик телеграма о том, что появились невалидные ответы или таймауты.

### Требования к оформлению дашборда
0. Указание единиц измерения чтобы было удобно проверять соблюдение SLA (+ опционально добавить черточки на уровне SLA и SLAx2)

## Среда выполнения

Графики о сервисе должны быть доступны для захода извне. Для
этого мы вам можем выдать сервер, если вы не получили его
по восьмому дз. Для получения можно всё так же обратиться к
Антону Чумакову.

## Нагрузка пользователей

Для имитации нагрузки пользователей вы можете поднять свой сервис
на своём сервере и уведомить об этом преподавателя. Преподаватель в свою
очередь поднимет docker образ на сервере с сервисами, который начнёт ходить
в ваш сервис в 10 потоков. Этот образ вы можете поднять точно так же у себя
локально:

- Для linux: `docker run --rm --network=host -e "SERVER_ADDR=localhost:8000" skinass/edu-vk-client /usr/local/bin/client`.
- Для mac/windows: `docker run --rm -e "SERVER_ADDR=host.docker.internal:8000" skinass/edu-vk-client /usr/local/bin/client`
